/* Query para Atualização das Notas Fiscais */


/* Escolhendo um Banco de Dados */
USE
	COMERCIO_OLTP
GO


/* Criando uma View Agregada */
CREATE VIEW V_NOTA_FISCAL AS
SELECT
	ID_NOTA_FISCAL,
	SUM(TOTAL) AS SOMA
FROM
	ITEM_NOTA
GROUP BY
	ID_NOTA_FISCAL


/* Criando uma View de Carga */
CREATE VIEW 
	V_CARGA_NF
AS
SELECT
	N.IDNOTA,
	N.TOTAL AS 'TOTAL NOTA',
	I.SOMA
FROM
	NOTA_FISCAL N
INNER JOIN
	V_NOTA_FISCAL I
ON
	IDNOTA = ID_NOTA_FISCAL
GO


/* Atualizando o Total da Nota Fiscal */
UPDATE 
	V_CARGA_NF 
SET
	[TOTAL NOTA] = SOMA
GO


/* Criando uma View Relatório */
CREATE VIEW
	V_RELATORIO_OLTP
AS
SELECT
	C.NOME,
	C.SOBRENOME,
	C.SEXO,
	N.DATA,
	N.IDNOTA,
	P.PRODUTO,
	N.TOTAL
FROM
	CLIENTE C
INNER JOIN
	NOTA_FISCAL N
ON
	C.IDCLIENTE = N.ID_CLIENTE
INNER JOIN
	ITEM_NOTA I
ON
	N.IDNOTA = I.ID_NOTA_FISCAL
INNER JOIN
	PRODUTO P
ON
	P.IDPRODUTO = I.ID_PRODUTO
GO